<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ë¥´ì½”í”„ íŠ¸ë˜ì»¤ (Tarkov Tracker)</title>
    <!-- ì „ì—­ CSS ë¡œë“œ -->
    <link rel="stylesheet" href="quest.css">
    <link rel="stylesheet" href="Common/css/global.css">
</head>
<body>
    <!-- ì•± ë ˆì´ì•„ì›ƒ -->
    <div class="app-container">
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="app-header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle" title="ì‚¬ì´ë“œë°” í† ê¸€">
                    <span class="toggle-icon">â˜°</span>
                </button>
            </div>
            <div class="header-center">
                <h1 class="app-title">íƒ€ë¥´ì½”í”„ íŠ¸ë˜ì»¤ (Tarkov Tracker)</h1>
                <h5> - with CrowsGear(byeong1)</h5>
            </div>
            <div class="header-right">
                <!-- í–¥í›„ ì¶”ê°€ ê¸°ëŠ¥ì„ ìœ„í•œ ê³µê°„ -->
            </div>
        </header>

        <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ (ì‚¬ì´ë“œë°” + ì½˜í…ì¸ ) -->
        <div class="main-layout">
            <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <!-- í”„ë¡œí•„ ì •ë³´ë¥¼ ìƒë‹¨ìœ¼ë¡œ ì´ë™ -->
                    <div class="profile-info">
                        <!-- ë ˆë²¨ ì„¤ì • ì»¨íŠ¸ë¡¤ -->
                        <div class="level-control">
                            <label class="level-label">í”Œë ˆì´ì–´ ë ˆë²¨</label>
                            <div class="level-input-group">
                                <button class="level-btn minus" id="levelMinusBtn">-</button>
                                <input type="number" id="sidebarPlayerLevel" min="1" max="79" value="1" class="level-input">
                                <button class="level-btn plus" id="levelPlusBtn">+</button>
                            </div>
                        </div>
                        
                        <!-- í†µê³„ ì •ë³´ -->
                        <div class="profile-stats">
                            ì™„ë£Œ: <span id="completedTasks">-</span> / <span id="totalTasks">-</span>
                        </div>
                    </div>
                </div>
            
                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
                <nav class="sidebar-nav">
                    <div class="nav-item active" data-route="dashboard">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span class="nav-text">ëŒ€ì‹œë³´ë“œ</span>
                    </div>
                    <div class="nav-item" data-route="quest">
                        <span class="nav-icon">ğŸ“</span>
                        <span class="nav-text">í€˜ìŠ¤íŠ¸</span>
                    </div>
                    <div class="nav-item" data-route="hideout">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-text">ì€ì‹ ì²˜</span>
                    </div>
                    <div class="nav-item" data-route="item">
                        <span class="nav-icon">ğŸ“¦</span>
                        <span class="nav-text">í•„ìˆ˜ ì•„ì´í…œ</span>
                    </div>
                    <div class="nav-item" data-route="settings">
                        <span class="nav-icon">âš™ï¸</span>
                        <span class="nav-text">ì„¤ì •</span>
                    </div>
                </nav>
            
                <!-- ì‚¬ì´ë“œë°” í•˜ë‹¨ ì˜ì—­ (ë¹„ì›Œë‘ ) -->
                <div class="sidebar-footer">
                </div>
            </aside>
            
            <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (ë™ì  ë¡œë”©) -->
            <main class="main-content" id="app-content">
                <!-- ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë  ì˜ì—­ -->
            </main>
        </div>
    </div>

    <!-- Core modules (ìˆœì„œëŒ€ë¡œ ë¡œë“œ) -->
    <script src="Common/javascript/LocalStorageManager.js"></script>
    <script src="Common/javascript/QuestManager.js"></script>
    <script src="Common/javascript/Pagination.js"></script>
    
    <!-- ì „ì—­ JavaScript ë¡œë“œ -->
    <script src="Common/javascript/utils.js"></script>
    <script src="router/index.js"></script>
    <script src="index.js"></script>

    <!-- WebView2 í†µì‹  ì„¤ì • -->
    <script>
        // C#ì—ì„œ ì˜¨ ë©”ì‹œì§€ ì²˜ë¦¬
        function handleMessageFromCSharp(event) {
            console.log('C#ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ :', event.data);
            
            try {
                const message = JSON.parse(event.data);
                
                switch (message.type) {
                    case 'QUEST_UPDATE':
                        // í€˜ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì²˜ë¦¬
                        if (window.currentComponent && window.currentComponent.handleQuestUpdate) {
                            window.currentComponent.handleQuestUpdate(message.data);
                        }
                        break;
                    case 'SYNC_REQUEST':
                        if (window.currentComponent && window.currentComponent.syncData) {
                            window.currentComponent.syncData();
                        }
                        break;
                    default:
                        console.log('ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ íƒ€ì…:', message.type);
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:', error);
            }
        }

        // C#ìœ¼ë¡œ ë©”ì‹œì§€ ì „ì†¡
        function sendMessageToCSharp(type, data) {
            if (window.chrome && window.chrome.webview) {
                const message = {
                    type: type,
                    data: data,
                    timestamp: new Date().toISOString()
                };
                
                window.chrome.webview.postMessage(JSON.stringify(message));
            } else {
                console.warn('WebView2 í†µì‹  í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤.');
            }
        }

        // WebView2 í†µì‹  ì„¤ì •
        if (window.chrome && window.chrome.webview) {
            window.chrome.webview.addEventListener('message', handleMessageFromCSharp);
        }

        // ì „ì—­ ê°ì²´ë¡œ ë…¸ì¶œ (C#ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
        window.TarkovTracker = {
            syncData: () => {
                if (window.currentComponent && window.currentComponent.syncData) {
                    window.currentComponent.syncData();
                }
            },
            navigateTo: (route) => {
                if (window.router) {
                    window.router.navigate(route);
                }
            },
            toggleSidebar: () => {
                const appContainer = document.querySelector('.app-container');
                if (appContainer) {
                    appContainer.classList.toggle('sidebar-hidden');
                }
            }
        };
    </script>
</body>
</html>